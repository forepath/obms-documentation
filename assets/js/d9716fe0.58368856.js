"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[6245],{7124:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"getting-started/installation/kubernetes","title":"Kubernetes Installation","description":"Introduction","source":"@site/docs/getting-started/installation/kubernetes.md","sourceDirName":"getting-started/installation","slug":"/getting-started/installation/kubernetes","permalink":"/docs/getting-started/installation/kubernetes","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Docker Installation","permalink":"/docs/getting-started/installation/docker"},"next":{"title":"Instance Configuration","permalink":"/docs/getting-started/configuration"}}');var s=t(4848),i=t(8453);const r={},l="Kubernetes Installation",o={},c=[{value:"Introduction",id:"introduction",level:2},{value:"Step-by-Step",id:"step-by-step",level:2},{value:"Create the Environment Secret",id:"create-the-environment-secret",level:3},{value:"Add the Helm Chart Repository",id:"add-the-helm-chart-repository",level:3},{value:"Configure the values-*.yaml Files",id:"configure-the-values-yaml-files",level:3},{value:"Deploy Using Helm",id:"deploy-using-helm",level:3},{value:"Generate the Application Key",id:"generate-the-application-key",level:3},{value:"Migrate Database",id:"migrate-database",level:3},{value:"Generate OAUTH Clients",id:"generate-oauth-clients",level:3},{value:"Accessing the Application",id:"accessing-the-application",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"kubernetes-installation",children:"Kubernetes Installation"})}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsxs)(n.p,{children:["If you want to deploy OBMS on Kubernetes, you can easily integrate it using the ",(0,s.jsx)(n.a,{href:"/docs/getting-started/installation/docker/#available-docker-images",children:"public Docker images"})," along with the Laravel Helm Chart. This allows you to leverage Kubernetes\u2019 scalability and management features while using the OBMS Docker images (",(0,s.jsx)(n.code,{children:"ghcr.io/obms-open-business-management-software/core-app"})," and ",(0,s.jsx)(n.code,{children:"ghcr.io/obms-open-business-management-software/core-worker"}),"). Below are the steps to deploy OBMS on Kubernetes using Helm."]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.h2,{id:"step-by-step",children:"Step-by-Step"}),"\n",(0,s.jsx)(n.h3,{id:"create-the-environment-secret",children:"Create the Environment Secret"}),"\n",(0,s.jsxs)(n.p,{children:["Begin by creating a ",(0,s.jsx)(n.code,{children:"secret.yaml"})," file to specify the contents of the ",(0,s.jsx)(n.code,{children:".env"})," file within the new containers:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'---\nkind: Secret\napiVersion: v1\nmetadata:\n  name: obms-env-secret\nstringData:\n  .env: |\n    APP_NAME=OBMS\n    APP_THEME=aurora\n    APP_ENV=production\n    APP_KEY=\n    APP_DEBUG=false\n    APP_URL=http://localhost\n\n    LOG_CHANNEL=stack\n    LOG_DEPRECATIONS_CHANNEL=null\n    LOG_LEVEL=debug\n\n    DB_CONNECTION=mysql\n    DB_HOST=mysql\n    DB_PORT=3306\n    DB_DATABASE=laravel\n    DB_USERNAME=sail\n    DB_PASSWORD=password\n\n    BROADCAST_DRIVER=log\n    CACHE_DRIVER=file\n    FILESYSTEM_DRIVER=local\n    QUEUE_CONNECTION=sync\n    SESSION_DRIVER=file\n    SESSION_LIFETIME=120\n\n    MEMCACHED_HOST=127.0.0.1\n\n    REDIS_HOST=redis\n    REDIS_PASSWORD=null\n    REDIS_PORT=6379\n\n    MAIL_MAILER=smtp\n    MAIL_HOST=mailhog\n    MAIL_PORT=1025\n    MAIL_USERNAME=null\n    MAIL_PASSWORD=null\n    MAIL_ENCRYPTION=null\n    MAIL_FROM_ADDRESS=null\n    MAIL_FROM_NAME="${APP_NAME}"\n    MAIL_SUPPORT_ADDRESS=hi@obms.one\n    MAIL_SUPPORT_NAME=Test\n\n    AWS_ACCESS_KEY_ID=\n    AWS_SECRET_ACCESS_KEY=\n    AWS_DEFAULT_REGION=us-east-1\n    AWS_BUCKET=\n    AWS_USE_PATH_STYLE_ENDPOINT=false\n\n    PUSHER_APP_ID=\n    PUSHER_APP_KEY=\n    PUSHER_APP_SECRET=\n    PUSHER_APP_CLUSTER=mt1\n\n    MIX_PUSHER_APP_KEY="${PUSHER_APP_KEY}"\n    MIX_PUSHER_APP_CLUSTER="${PUSHER_APP_CLUSTER}"\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Note that you are required to at least modify the parameters for the ",(0,s.jsx)(n.code,{children:"DB"}),", ",(0,s.jsx)(n.code,{children:"REDIS"})," and ",(0,s.jsx)(n.code,{children:"MAIL"})," connections. Also, we advise to set an ",(0,s.jsx)(n.code,{children:"APP_KEY"})," and modify the ",(0,s.jsx)(n.code,{children:"APP_URL"})," to ensure proper data encryption and user redirects. If you want to generate an ",(0,s.jsx)(n.code,{children:"APP_KEY"})," using a ",(0,s.jsx)(n.code,{children:"bash"})," command you can do so by utilizing the ",(0,s.jsx)(n.code,{children:"openssl"})," utility:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'echo "APP_KEY=base64:$(openssl rand -base64 32)"\n'})}),"\n",(0,s.jsx)(n.p,{children:"These values will be used to configure the main instance of the application. Some may be overridden by the dynamic parameterization utility of OBMS. After modifying the file accordingly, run the following command to publish the new secret to the Kubernetes cluster:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f secret.yaml\n"})}),"\n",(0,s.jsx)(n.h3,{id:"add-the-helm-chart-repository",children:"Add the Helm Chart Repository"}),"\n",(0,s.jsxs)(n.p,{children:["Continue by adding the ",(0,s.jsx)(n.a,{href:"https://github.com/renoki-co/charts",children:"Laravel Helm Chart"})," repository to your Helm setup:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"helm repo add renoki-co https://renoki.co/charts\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"helm repo update\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configure-the-values-yaml-files",children:"Configure the values-*.yaml Files"}),"\n",(0,s.jsxs)(n.p,{children:["Create a ",(0,s.jsx)(n.code,{children:"values-app.yaml"})," and ",(0,s.jsx)(n.code,{children:"values-worker.yaml"})," file to specify the OBMS Docker images for the Laravel Helm chart. You need to define both the main application image (",(0,s.jsx)(n.code,{children:"ghcr.io/obms-open-business-management-software/core-app"}),") and the worker image (",(0,s.jsx)(n.code,{children:"ghcr.io/obms-open-business-management-software/core-worker"}),"). Here's an example app configuration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"app:\n  image:\n    repository: ghcr.io/obms-open-business-management-software/core-app\n    pullPolicy: Always\n    tag: latest\n  envSecretName: obms-env-secret\n"})}),"\n",(0,s.jsx)(n.p,{children:"For the worker an additional modification of the start command is needed. Here's an example worker configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"app:\n  image:\n    repository: ghcr.io/obms-open-business-management-software/core-worker\n    pullPolicy: Always\n    tag: latest\n  command: php artisan horizon\n  envSecretName: obms-env-secret\n"})}),"\n",(0,s.jsxs)(n.p,{children:["These YAML files specify that both the app and worker containers will use the ",(0,s.jsx)(n.code,{children:"latest"})," tags for the images. You can adjust the tag field if you need to use a specific version."]}),"\n",(0,s.jsx)(n.h3,{id:"deploy-using-helm",children:"Deploy Using Helm"}),"\n",(0,s.jsxs)(n.p,{children:["Now, use the Helm chart to deploy OBMS on Kubernetes. Run the following command to install the Laravel chart with your custom ",(0,s.jsx)(n.code,{children:"values-*.yaml"})," configuration:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"helm install obms renoki-co/laravel -f values-app.yaml\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"helm install obms renoki-co/laravel-worker -f values-worker.yaml\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This will deploy OBMS using the Docker images specified in the ",(0,s.jsx)(n.code,{children:"values-*.yaml"})," file. It will configure the necessary Kubernetes resources like deployments, services, and persistent volumes."]}),"\n",(0,s.jsx)(n.h3,{id:"generate-the-application-key",children:"Generate the Application Key"}),"\n",(0,s.jsx)(n.p,{children:"Generate an application key."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it laravel -- php artisan key:generate\n"})}),"\n",(0,s.jsx)(n.h3,{id:"migrate-database",children:"Migrate Database"}),"\n",(0,s.jsx)(n.p,{children:"Migrate the database schema."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it laravel -- php artisan migrate --no-interaction --force\n"})}),"\n",(0,s.jsx)(n.h3,{id:"generate-oauth-clients",children:"Generate OAUTH Clients"}),"\n",(0,s.jsx)(n.p,{children:"Generate set of OAUTH clients needed for API authentication."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"kubectl exec -it laravel -- php artisan passport:install --no-interaction\n"})}),"\n",(0,s.jsx)(n.h3,{id:"accessing-the-application",children:"Accessing the Application"}),"\n",(0,s.jsxs)(n.p,{children:["Once deployed, you can access the application based on how your Kubernetes cluster is configured. This may include exposing the application via a load balancer or using ",(0,s.jsx)(n.code,{children:"kubectl port-forward"})," for local access."]}),"\n",(0,s.jsxs)(n.p,{children:["For a detailed overview of the available Helm chart options please consult the respective ",(0,s.jsx)(n.a,{href:"https://github.com/renoki-co/charts/blob/master/charts/laravel/values.yaml",children:"documentation"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>r,x:()=>l});var a=t(6540);const s={},i=a.createContext(s);function r(e){const n=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),a.createElement(i.Provider,{value:n},e.children)}}}]);